import{_ as h}from"./index-CMM8buZn.js";class v{constructor(t){this.apiKey=t||"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"}async generateComprehensiveReport(t,i,n,e=null){console.log("ğŸ¤– Starting AI-powered comprehensive report generation...");const{analyzeResponsesWithSmartScoring:r,mapResponsesToReflexesWithSmartScoring:a}=await h(async()=>{const{analyzeResponsesWithSmartScoring:m,mapResponsesToReflexesWithSmartScoring:p}=await import("./smartScoringSystem-BTpiFqYX.js");return{analyzeResponsesWithSmartScoring:m,mapResponsesToReflexesWithSmartScoring:p}},[]),s=r(i,n),o=a(i,n),c=this.prepareAIContext(t,s,o,e),l=await this.generateAINarrative(c),d=await this.generateReflexIntegrationPlan(o,t.child_age),g=await this.generateMonthlyRoadmap(s,o,t);return{metadata:{generatedAt:new Date().toISOString(),childAge:t.child_age,assessmentId:t.id,aiGenerated:!0},executiveSummary:{aiNarrative:l,overallStatus:this.determineOverallStatus(s,o),developmentalAge:this.calculateDevelopmentalAge(s,t.child_age),keyFindings:this.extractKeyFindings(s,o),urgentActions:this.identifyUrgentActions(s,o)},detailedAnalysis:{categoryBreakdown:this.formatCategoryAnalysis(s),redFlags:s.redFlags,strengths:s.strengths,smartScores:s.categoryScores},reflexIntegration:{summary:o.summary,detectedReflexes:o.reflexes,priorityReflexes:o.priorityReflexes,integrationPlan:d,expectedTimeline:this.generateReflexTimeline(o)},interventionPlan:{immediate:this.generateImmediateInterventions(s,o),monthlyRoadmap:g,homeProgram:this.generateHomeProgram(s,o),professionalSupport:this.recommendProfessionals(s,o)},parentGuidance:{understanding:this.generateParentEducation(o),dailyTips:this.generateDailyTips(s,o),warningSignsToWatch:this.identifyWarningSigns(s),whenToSeekHelp:this.generateHelpGuidelines(s,o)},additionalConsiderations:{uploadedReportsAnalysis:e?await this.analyzeUploadedReports(e):null,parentConcerns:t.main_concerns,recommendations:this.generateFinalRecommendations(s,o)}}}prepareAIContext(t,i,n,e){return{child:{name:t.child_first_name,age:t.child_age,gender:t.child_gender,concerns:t.main_concerns,birthHistory:t.child_birth_history,diagnoses:t.child_diagnoses,medications:t.child_medications},assessment:{scores:i.categoryScores,redFlags:i.redFlags,strengths:i.strengths},reflexes:n.reflexes,uploadedReports:e}}async generateAINarrative(t){var n;if(!this.apiKey)return this.generateFallbackNarrative(t);const i=`
    As a pediatric developmental specialist, analyze this child's assessment and provide a comprehensive narrative summary.
    
    Child Information:
    - Age: ${t.child.age} years
    - Gender: ${t.child.gender}
    - Parent Concerns: ${t.child.concerns||"None specified"}
    - Birth History: ${t.child.birthHistory||"Not provided"}
    - Diagnoses: ${((n=t.child.diagnoses)==null?void 0:n.join(", "))||"None"}
    
    Assessment Results:
    ${JSON.stringify(t.assessment.scores,null,2)}
    
    Red Flags Identified:
    ${t.assessment.redFlags.map(e=>`- ${e.issue}`).join(`
`)}
    
    Retained Primitive Reflexes:
    ${t.reflexes.map(e=>`- ${e.name}: ${e.retentionLevel}% retention`).join(`
`)}
    
    Please provide:
    1. A comprehensive interpretation of these results
    2. How retained reflexes are impacting development
    3. The relationship between symptoms and underlying neurological patterns
    4. Priority areas for intervention
    5. Prognosis with and without intervention
    
    Write in a professional but parent-friendly tone. Be specific and actionable.
    `;try{const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a pediatric developmental specialist with expertise in primitive reflex integration, sensory processing, and child development. Provide detailed, evidence-based analysis while being compassionate and parent-friendly."},{role:"user",content:i}],temperature:.7,max_tokens:2e3})});if(e.ok)return(await e.json()).choices[0].message.content}catch(e){console.error("AI narrative generation failed:",e)}return this.generateFallbackNarrative(t)}async generateReflexIntegrationPlan(t,i){const n={};return t.reflexes.forEach(e=>{n[e.name]={retentionLevel:e.retentionLevel,impact:e.impact,category:e.category,exercises:{daily:this.selectDailyExercises(e,i),weekly:this.selectWeeklyActivities(e,i),environmental:this.getEnvironmentalModifications(e)},timeline:{month1:{goal:`Reduce ${e.name} retention by 20%`,frequency:"2-3 times daily, 5 minutes each",exercises:e.exercises.slice(0,2),signs:this.getProgressMarkers(e,1)},month2:{goal:"Achieve 40% reduction in retention",frequency:"2 times daily, 7 minutes each",exercises:e.exercises.slice(1,3),signs:this.getProgressMarkers(e,2)},month3:{goal:"Achieve 60% or greater reduction",frequency:"Daily maintenance, 10 minutes",exercises:e.exercises.slice(2,4),signs:this.getProgressMarkers(e,3)}},parentTips:this.generateReflexSpecificTips(e),warningSignsOfRegression:this.getReflexRegressionSigns(e)}}),n}async generateMonthlyRoadmap(t,i,n){return{month1:{theme:"Foundation & Stabilization",focus:this.determinePrimaryFocus(t,i),reflexGoals:i.priorityReflexes.slice(0,2).map(r=>({reflex:r,targetReduction:"20%",dailyTime:"15 minutes"})),developmentalGoals:this.extractDevelopmentalGoals(t,1),weeklySchedule:this.createWeeklySchedule(i,t,1),parentEducation:["Understanding primitive reflexes","Creating sensory-friendly environment","Establishing routines"],expectedOutcomes:["Improved awareness of body position","Reduced anxiety/startle responses","Better sleep patterns"]},month2:{theme:"Integration & Progress",focus:"Building on foundation, introducing complex movements",reflexGoals:i.priorityReflexes.map(r=>({reflex:r,targetReduction:"40%",dailyTime:"20 minutes"})),developmentalGoals:this.extractDevelopmentalGoals(t,2),weeklySchedule:this.createWeeklySchedule(i,t,2),parentEducation:["Recognizing integration signs","Adjusting exercises for progress","Supporting emotional regulation"],expectedOutcomes:["Improved coordination","Better attention span","Enhanced motor planning"]},month3:{theme:"Mastery & Maintenance",focus:"Consolidating gains, preventing regression",reflexGoals:i.reflexes.map(r=>({reflex:r.name,targetReduction:"60%+",dailyTime:"15 minutes maintenance"})),developmentalGoals:this.extractDevelopmentalGoals(t,3),weeklySchedule:this.createWeeklySchedule(i,t,3),parentEducation:["Maintaining progress long-term","Transitioning to play-based integration","Preparing for re-assessment"],expectedOutcomes:["Sustained improvements","Age-appropriate skills emerging","Increased confidence and independence"]}}}determinePrimaryFocus(t,i){if(i.priorityReflexes.length>0){const e=i.reflexes[0];if(e&&e.retentionLevel>=70)return`${e.name} integration - Critical for development`}const n=Object.entries(t.categoryScores).filter(([e,r])=>r.percentage<40).sort((e,r)=>e[1].percentage-r[1].percentage);return n.length>0?`${n[0][0]} development - Significant delays detected`:t.redFlags.length>=5?"Address multiple red flags through structured intervention":"Foundation skill building and reflex integration"}determineOverallStatus(t,i){const n=Object.values(t.categoryScores).reduce((a,s)=>a+s.percentage,0)/Object.keys(t.categoryScores).length,e=i.priorityReflexes.length,r=t.redFlags.length;return n>=80&&e===0&&r===0?"Excellent - Development on track":n>=70&&e<=1&&r<=2?"Good - Minor areas for improvement":n>=50&&e<=3?"Moderate Concerns - Intervention recommended":"Significant Concerns - Immediate intervention needed"}calculateDevelopmentalAge(t,i){const n=Object.values(t.categoryScores).reduce((a,s)=>a+s.percentage,0)/Object.keys(t.categoryScores).length,e=Math.round((100-n)*.6),r=i-e/12;return Math.max(0,Math.round(r*10)/10)}extractKeyFindings(t,i){const n=[];return i.priorityReflexes.length>0&&n.push(`Retained primitive reflexes affecting development: ${i.priorityReflexes.join(", ")}`),Object.entries(t.categoryScores).forEach(([e,r])=>{r.percentage<50?n.push(`${e}: Significant delays detected (${r.percentage}%)`):r.concerns.length>0&&n.push(`${e}: ${r.concerns.length} red flags identified`)}),t.strengths.length>0&&n.push(`Strengths identified in: ${t.strengths.map(e=>e.category).join(", ")}`),n}extractKeyFindings(t,i){const n=[];return i.priorityReflexes.length>0&&n.push(`Retained primitive reflexes affecting development: ${i.priorityReflexes.join(", ")}`),Object.entries(t.categoryScores).forEach(([e,r])=>{r.percentage<50?n.push(`${e}: Significant delays detected (${r.percentage}%)`):r.concerns.length>0&&n.push(`${e}: ${r.concerns.length} red flags identified`)}),t.strengths.length>0&&n.push(`Strengths identified in: ${t.strengths.map(e=>e.category).join(", ")}`),n}formatCategoryAnalysis(t){const i={};return Object.entries(t.categoryScores).forEach(([n,e])=>{i[n]={score:e.percentage,interpretation:e.interpretation,concerns:e.concerns,strengths:e.strengths,recommendations:e.recommendations||[],details:{rawScore:e.rawScore,maxScore:e.maxScore,redFlags:e.concerns.filter(r=>r.severity==="high").length,achievements:e.strengths.length}}}),i}identifyUrgentActions(t,i){const n=[];t.redFlags.forEach(r=>{(r.issue.includes("safety")||r.issue.includes("danger"))&&n.push({action:"Address safety concern",detail:r.issue,timeline:"Immediately"})}),i.reflexes.forEach(r=>{r.retentionLevel>=70&&n.push({action:`Begin ${r.name} integration`,detail:`High retention (${r.retentionLevel}%) affecting ${r.category}`,timeline:"Within 1 week"})});const e=Object.entries(t.categoryScores).filter(([r,a])=>a.percentage<50).map(([r,a])=>r);return e.length>=3&&n.push({action:"Schedule comprehensive evaluation",detail:`Multiple developmental areas affected: ${e.join(", ")}`,timeline:"Within 2 weeks"}),n}selectDailyExercises(t,i){return t.exercises.filter(e=>!(i<=3&&e.includes("complex")||i>=6&&e.includes("baby"))).slice(0,3)}selectWeeklyActivities(t,i){return{moro:["Swimming","Trampoline with supervision","Yoga for kids"],palmar:["Rock climbing","Pottery/clay work","Cooking activities"],atnr:["Martial arts","Dance classes","Ball sports"],spinalGalant:["Swimming backstroke","Gymnastics","Horseback riding"],tlr:["Playground activities","Balance beam","Scooter riding"],stnr:["Animal walks obstacle course","Swimming","Climbing"]}[t.name.toLowerCase().split(" ")[0]]||["Occupational therapy activities"]}getEnvironmentalModifications(t){return{moro:["Reduce sudden noises","Use weighted blanket for sleep","Create calm-down corner","Dim lights in evening"],palmar:["Provide fidget tools","Use pencil grips","Textured surfaces for exploration","Hand strengthening toys"],spinalGalant:["Avoid tight waistbands","Use wobble cushion for sitting","Provide movement breaks","Consider standing desk option"]}[t.name.toLowerCase().split(" ")[0]]||[]}getProgressMarkers(t,i){const n=["Reduced frequency of reflex response","Improved motor control","Better emotional regulation"],e={1:["Initial awareness of body position","Slight reduction in symptoms"],2:["Noticeable improvement in daily activities","Better coordination"],3:["Significant reduction in reflex indicators","Age-appropriate skills emerging"]};return[...n,...e[i]]}generateReflexSpecificTips(t){return["Make exercises fun - turn them into games","Practice when child is calm and alert","Stop if child becomes distressed","Celebrate small improvements","Keep a progress journal"]}getReflexRegressionSigns(t){return["Return of previous symptoms","Increased clumsiness or falls","Behavioral regression","Sleep disturbances","Increased anxiety or emotional outbursts"]}generateFallbackNarrative(t){return`Based on the assessment of ${t.child.name}, age ${t.child.age}, several important findings have emerged. The evaluation reveals both strengths and areas requiring support across multiple developmental domains. ${t.reflexes.length>0?`Notably, ${t.reflexes.length} retained primitive reflexes were identified, which may be impacting overall development.`:""} A comprehensive intervention plan focusing on both remediation and skill building is recommended.`}createWeeklySchedule(t,i,n){return{monday:"Reflex integration exercises (15 min) + Fine motor activities",tuesday:"Gross motor play + Balance activities",wednesday:"Reflex integration + Sensory play",thursday:"Cross-lateral movements + Academic readiness",friday:"Fun integration games + Social skills",weekend:"Family activities incorporating therapeutic movements"}}extractDevelopmentalGoals(t,i){const n=[];return Object.entries(t.categoryScores).forEach(([e,r])=>{var a;r.percentage<70&&n.push({category:e,currentLevel:`${r.percentage}%`,targetLevel:`${Math.min(100,r.percentage+i*10)}%`,focus:((a=r.concerns[0])==null?void 0:a.category)||"General improvement"})}),n}generateReflexTimeline(t){const i={};return t.reflexes.forEach(n=>{const e=n.retentionLevel;let r="";e>=70?r="4-6 months with daily exercises":e>=40?r="2-4 months with regular practice":r="1-2 months with consistent exercises",i[n.name]={currentRetention:`${e}%`,estimatedTimeToIntegration:r,monthlyTargets:{month1:`Reduce to ${Math.max(0,e-20)}%`,month2:`Reduce to ${Math.max(0,e-40)}%`,month3:`Reduce to ${Math.max(0,e-60)}%`}}}),i}generateImmediateInterventions(t,i){const n=[];if(i.priorityReflexes.length>0){const e=i.reflexes[0];e&&n.push({category:"Reflex Integration",action:`Begin ${e.name} exercises`,frequency:"Daily, 2-3 times",duration:"5-10 minutes per session",exercises:e.exercises?e.exercises.slice(0,3):[],expectedBenefit:"Improved nervous system integration"})}return Object.entries(t.categoryScores).forEach(([e,r])=>{r.percentage<50&&n.push({category:e,action:`${e} support activities`,frequency:"Daily",duration:"15 minutes",exercises:[`${e}-specific developmental activities`],expectedBenefit:`Improved ${e.toLowerCase()} skills`})}),t.redFlags.length>0&&n.push({category:"Safety",action:"Address red flag concerns",frequency:"Ongoing monitoring",duration:"Throughout day",exercises:["Environmental modifications","Safety protocols"],expectedBenefit:"Reduced risk and improved safety"}),n}generateHomeProgram(t,i){return{daily:{morning:"Sensory wake-up routine (5 min)",afternoon:"Reflex integration exercises (10 min)",evening:"Calming activities and deep pressure (10 min)"},weekly:{outdoorPlay:"3-4 times, 30 minutes minimum",structuredActivities:"2-3 therapy-based games",socialInteraction:"Planned playdates or group activities"}}}recommendProfessionals(t,i){const n=[];return i.priorityReflexes.length>=2&&n.push({specialist:"Occupational Therapist (Reflex Integration Specialist)",reason:"Multiple retained primitive reflexes",urgency:"High",frequency:"Weekly initially, then biweekly"}),Object.entries(t.categoryScores).forEach(([e,r])=>{r.percentage<50&&(e.includes("Speech")&&n.push({specialist:"Speech-Language Pathologist",reason:`Speech delays (${r.percentage}% of age expectations)`,urgency:"High",frequency:"Twice weekly"}),e.includes("Motor")&&n.push({specialist:"Physical Therapist",reason:"Motor delays identified",urgency:"Moderate",frequency:"Weekly"}))}),n}generateParentEducation(t){return{understanding:"Primitive reflexes are automatic movements that should integrate in infancy. When retained, they can interfere with development.",yourChildsReflexes:t.reflexes.map(i=>({reflex:i.name,whatItMeans:i.impact,howToHelp:i.exercises[0]})),resources:['Recommended book: "Reflexes, Learning and Behavior" by Sally Goddard',"Online course: Understanding Primitive Reflexes","Support group: Parents of Children with Retained Reflexes"]}}generateDailyTips(t,i){const n=["Establish consistent routines","Provide sensory breaks every 45 minutes","Use visual schedules and timers","Celebrate small victories","Maintain a calm environment"];return i.priorityReflexes.includes("moro")&&n.push("Reduce sudden noises and transitions"),t.redFlags.some(e=>e.issue.includes("attention"))&&n.push("Break tasks into smaller steps"),n}identifyWarningSigns(t){return t.redFlags.map(i=>({sign:i.issue,category:i.category,action:"Monitor and document frequency"}))}identifyWarningSigns(t){const i=[];return t.redFlags.forEach(n=>{i.push({sign:n.issue,category:n.category,action:"Monitor and document frequency"})}),Object.entries(t.categoryScores).forEach(([n,e])=>{e.percentage<50&&i.push({sign:`Delays in ${n} development`,category:n,action:"Track progress monthly"}),e.concerns.length>=3&&i.push({sign:`Multiple concerns in ${n}`,category:n,action:"Consider professional evaluation"})}),i}generateHelpGuidelines(t,i){const n=[];return t.redFlags.length>=5&&n.push("Multiple red flags present - seek evaluation within 2 weeks"),i.priorityReflexes.length>=3&&n.push("Multiple retained reflexes - occupational therapy evaluation recommended"),n.push("If regression occurs in any area, contact healthcare provider"),n.push("Document concerns with video when possible"),n}async analyzeUploadedReports(t){return{summary:"Analysis of uploaded documents",findings:[],recommendations:[]}}generateFinalRecommendations(t,i){return{immediate:this.identifyUrgentActions(t,i),shortTerm:"Begin reflex integration program with daily exercises",longTerm:"Monitor progress monthly and adjust interventions",followUp:"Re-assessment recommended in 3 months"}}}export{v as AIReportGenerator,v as default};
